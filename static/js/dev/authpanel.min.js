function import$(t,e){var n={}.hasOwnProperty;for(var a in e)n.call(e,a)&&(t[a]=e[a]);return t}var authpanel;(authpanel=function(t){return null==t&&(t={}),this.opt=t,this.root="string"==typeof t.root?document.querySelector(t.root):t.root,t.isValid&&(this.isValid=t.isValid),this.action="signup",this.auth=t.auth,this.init(),this}).prototype=import$(Object.create(Object.prototype),{setAction:function(t){return this.action=t},init:function(){var t=this;return this.view=new ldView({root:this.root,handler:{submit:function(){}},action:{keyup:{password:function(e){if(13===e.evt.keyCode)return t.form.check({now:!0}).then(function(){return t.submit()})}},click:{submit:function(){return t.submit()}}}}),this.ldld=new ldLoader({root:this.view.get("submit")}),this.form=new ldForm({names:function(){return["username","password","displayname"]},afterCheck:function(e,n){return 1===e.username||t.isValid.username(n.username.value)||(e.username=2),1!==e.password&&(e.password=n.password.value?t.isValid.password(n.password.value)?0:2:1),"login"===auth.act?e.displayname=0:e.displayname=n.displayname.value?n.displayname.value?0:2:1},root:this.root}),this.form.on("readystatechange",function(e){return t.view.get("submit").classList.toggle("disabled",!e)})},submit:function(){var t,e,n,a=this;if(this.form.ready())return this.ldld.on(),t=this.form.values(),n={},n.username=t.username,n.password=t.password,n.displayname=t.displayname,e=n,Promise.resolve().then(function(){return{},ld$.fetch(a.auth.apiRoot()+""+a.action,{method:"POST"},{json:e})}).then(function(){return a.auth.fetch()}).then(function(t){return a.setInfo("default"),t.user&&lda.auth.hide("ok"),a.form.reset(),a.ldld.off()}).catch(function(){return a.setInfo("signup"===a.action?"signup-failed":"failed"),a.form.fields.password.value=null,a.form.check({n:"password",now:!0}),a.ldld.off()})},isValid:{username:function(t){return/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(t)},password:function(t){return/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.exec(t+"")}}}),new authpanel({root:".authpanel",auth:new auth});