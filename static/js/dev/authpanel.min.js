function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var authpanel;(authpanel=function(t){return null==t&&(t={}),this.opt=t,this.root="string"==typeof t.root?document.querySelector(t.root):t.root,t.isValid&&(this.isValid=t.isValid),this.action="signup",this.auth=t.auth,this.ready=!1,this.info="default",this.init(),this}).prototype=import$(Object.create(Object.prototype),{setAction:function(t){return this.action=t},toggle:function(t){return this.action=t,this.view.render(["form","tab","show"])},setInfo:function(t){return this.info=t,this.view.render(["info"])},init:function(){var t=this;return this.view=new ldView({root:this.root,handler:{"forgot-password":function(t){return t.node.setAttribute("href","/auth/reset/")},submit:function(e){return e.node.classList.toggle("disabled",!t.ready)},form:function(e){var n;return n=e.node,["login","signup"].map(function(e){return n.classList.toggle(e,t.action===e)})},info:function(e){var n;return(n=e.node).classList.toggle("d-none",n.getAttribute("data-name")!==t.info)},tab:function(e){var n,r;return n=e.node,r=n.getAttribute("data-name"),n.classList.toggle("active",t.action===r)},show:function(e){var n,r;return n=e.node,r=n.getAttribute("data-tab"),n.classList.toggle("d-none",t.action!==r)}},action:{keyup:{password:function(e){if(13===e.evt.keyCode)return t.form.check({now:!0}).then(function(){return t.submit()})}},click:{submit:function(){return t.submit()},tab:function(e){var n;return n=e.node,t.toggle(n.getAttribute("data-name"))}}}}),this.ldld=new ldLoader({root:this.view.get("submit")}),this.form=new ldForm({names:function(){return["username","password","displayname"]},afterCheck:function(e,n){return 1===e.username||t.isValid.username(n.username.value)||(e.username=2),1!==e.password&&(e.password=n.password.value?t.isValid.password(n.password.value)?0:2:1),"login"===auth.act?e.displayname=0:e.displayname=n.displayname.value?n.displayname.value?0:2:1},root:this.root}),this.form.on("readystatechange",function(e){return t.ready=e,t.view.render(["submit"])})},submit:function(){var t,e,n,r=this;if(this.form.ready())return this.ldld.on(),t=this.form.values(),n={},n.username=t.username,n.password=t.password,n.displayname=t.displayname,e=n,Promise.resolve().then(function(){return{},ld$.fetch(r.auth.apiRoot()+""+r.action,{method:"POST"},{json:e})}).then(function(){return r.auth.fetch()}).then(function(t){return r.setInfo("default"),t.user&&lda.auth.hide("ok"),r.form.reset(),r.ldld.off()}).catch(function(){return r.setInfo("signup"===r.action?"signup-failed":"failed"),r.form.fields.password.value=null,r.form.check({n:"password",now:!0}),r.ldld.off()})},isValid:{username:function(t){return curegex.get("email").exec(t)},password:function(t){return t&&t.length>=8}}}),new authpanel({root:".authpanel",auth:new auth});