<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/css/pack/vendor.min.css"><link rel="stylesheet" type="text/css" href="/css/index.css"></head><body><div class="w-1024 rwd mx-auto my-4"><h4>Authentication</h4><hr><div><b>Current Status</b><p ld="status">Not login</p></div><div><b>User Name</b><p ld="username">n/a</p></div><div><b>User Id</b><p ld="userid">n/a</p></div><div class="btn btn-primary mr-2" ld="signup not-signed">Sign Up</div><div class="btn btn-primary mr-2" ld="login not-signed">Login</div><div class="btn btn-primary mr-2" ld="logout signed">Logout</div><div class="btn btn-primary" ld="reauth">Re-auth</div><div class="ldcv" ld-scope="signup"><div class="base"><div class="inner p-4"><form method="POST" action="/api/auth/signup"><div class="form-group"><label>email</label><input class="form-control" ld="username" type="text" name="username" autocomplete="username"></div><div class="form-group"><label>displayname</label><input class="form-control" ld="displayname" type="text" name="displayname" autocomplete="displayname"></div><div class="form-group"><label>password</label><input class="form-control" ld="password" type="password" name="password" autocomplete="new-password"></div><input type="hidden" name="_csrf"><input class="btn btn-primary mr-2" type="submit"><div class="btn btn-primary" ld="inline-submit">Submit ( no reload )</div></form></div></div></div><div class="ldcv" ld-scope="login"><div class="base"><div class="inner p-4"><form method="POST" action="/api/auth/login"><div class="form-group"><label>email</label><input class="form-control" ld="username" type="text" name="username" autocomplete="username"></div><div class="form-group"><label>password</label><input class="form-control" ld="password" type="password" name="password" autocomplete="new-password"></div><input type="hidden" name="_csrf"><input class="btn btn-primary mr-2" type="submit"><div class="btn btn-primary" ld="inline-submit">Submit ( no reload )</div></form></div></div></div></div><script type="text/javascript" src="/js/pack/vendor.min.js"></script><script type="text/javascript" src="/js/dev/auth.js"></script><script>// Generated by LiveScript 1.3.1
var lc, ldcv, view, a;
lc = {};
ldcv = {};
view = {};
ldcv.signup = new ldCover({
  root: '[ld-scope=signup]'
});
ldcv.login = new ldCover({
  root: '[ld-scope=login]'
});
view.signup = new ldView({
  root: '[ld-scope=signup]',
  action: {
    click: {
      "inline-submit": function(){
        var data;
        data = {};
        ['username', 'displayname', 'password'].map(function(it){
          return data[it] = view.signup.get(it).value;
        });
        return ld$.fetch("/api/auth/signup", {
          method: 'POST'
        }, {
          type: 'json',
          json: data
        }).then(function(){
          return ldcv.signup.toggle(false);
        })['catch'](function(it){
          return console.log('failed', it);
        });
      }
    }
  }
});
view.login = new ldView({
  root: '[ld-scope=login]',
  action: {
    click: {
      "inline-submit": function(){
        var data;
        data = {};
        ['username', 'password'].map(function(it){
          return data[it] = view.login.get(it).value;
        });
        return ld$.fetch("/api/auth/login", {
          method: 'POST'
        }, {
          json: data
        }).then(function(){
          return ldcv.login.toggle(false);
        }).then(function(){
          return lc.a.fetch();
        }).then(function(g){
          lc.global = g;
          lc.user = g.user;
          return view.panel.render();
        })['catch'](function(it){
          return console.log('failed', it);
        });
      }
    }
  }
});
view.panel = new ldView({
  root: document.body,
  action: {
    click: {
      signup: function(){
        return ldcv.signup.toggle();
      },
      login: function(){
        return ldcv.login.toggle();
      },
      logout: function(){
        return ld$.fetch("/api/auth/logout", {
          method: "POST"
        }).then(function(){
          return lc.a.fetch();
        }).then(function(g){
          g == null && (g = {});
          lc.global = g;
          lc.user = g.user;
          return view.panel.render();
        })['catch'](function(it){
          return console.log('failed', it);
        });
      },
      reauth: function(){}
    }
  },
  text: {
    username: function(){
      return (lc.user || (lc.user = {})).username || 'n/a';
    },
    userid: function(){
      return (lc.user || (lc.user = {})).key || 'n/a';
    }
  },
  handler: {
    signed: function(arg$){
      var node;
      node = arg$.node;
      return node.classList.toggle('d-none', !(lc.user || (lc.user = {})).username);
    },
    "not-signed": function(arg$){
      var node;
      node = arg$.node;
      return node.classList.toggle('d-none', !!(lc.user || (lc.user = {})).username);
    },
    status: function(arg$){
      var node;
      node = arg$.node;
      node.innerText = (lc.user || (lc.user = {})).username ? 'Signed in' : 'Not login';
      return node.classList.toggle('text-danger', !(lc.user || (lc.user = {})).username);
    }
  }
});
ld$.fetch('/api/auth/info', {
  method: 'GET'
}, {
  type: 'json'
}).then(function(g){
  var ref$;
  g == null && (g = {});
  console.log("global: ", g);
  ld$.find('[name=_csrf]').map(function(f){
    return f.value = g.csrfToken;
  });
  ((ref$ = ld$.fetch).headers || (ref$.headers = {}))['X-CSRF-Token'] = g.csrfToken;
  lc.global = g;
  lc.user = g.user;
  return view.panel.render();
})['catch'](function(it){
  return console.log(it);
});
ldcv.logout = new ldCover({
  root: ld$.find('.ldcv[data-name=logout]', 0)
});
lc.a = a = new auth({
  ui: {
    timeout: function(){},
    authpanel: function(){
      return ldcv.login.get();
    }
  }
});
a.on('error', function(){
  return console.log('error');
});
a.on('server-down', function(){
  return console.log('server-down');
});
a.on('logout', function(){});
a.fetch().then(function(it){
  return console.log(it);
});
a.ensure().then(function(it){
  return console.log(">", it);
});</script></body></html>