<div><script type="@plotdb/block">var i18nResource;i18nResource={"zh-TW":{email:"電子郵件","your email address, as account name":"您的電子郵件地址做為帳戶名","invalid email address":"無效的電子郵件","display name":"顯示名稱","such as 'Paris Hillton'":"例如: 王小明","requried field":"不能留白","password too short":"密碼不能太短","password incorrect":"密碼不正確","how shuold we call you":"您希望我們如何稱呼您?",password:"密碼","at least 8 characters":"至少八個字元","by sign-in, you agree to our":"登入即代表您同意我們的",and:"和","or login with":"或使用下列登入",Terms:"使用條款","Privacy Policy":"隱私權政策",Login:"登入",Signup:"註冊","Sign Up":"註冊","Forget Password":"忘記密碼","code we sent you for using this service":"由我們另外發給您的邀請碼","invitation code":"邀請碼","invalid invitation code":"無效的邀請碼","Switch to Password Login":"切換回帳號登入 / 註冊","by Invitation":"使用邀請碼","login successfully":"成功登入"}};module.exports={pkg:{name:"auth",version:"0.0.1",path:"base.html",i18n:i18nResource,dependencies:[{name:"ldview",version:"main"},{name:"ldnotify",version:"main"},{name:"ldform",version:"main"},{name:"ldbutton",version:"main",type:"css"},{name:"@loadingio/loading.css",version:"main",path:"lite.min.css"},{name:"ldnotify",version:"main",type:"css",global:true},{name:"curegex",version:"main",path:"curegex.min.js"}]},init:function(n){var e,a,o,u,s,t,r,d,i=this;e=n.ctx,a=n.root,o=n.data,u=n.t;s=e.ldview,t=e.ldnotify,r=e.curegex,d=e.ldform;return function(n){return n.apply(i.mod=i.mod(e))}(function(){var n,e,t,r,i=this;this.ldcv=n={};this._auth=o.auth;e=ld$.find(a,".ldcv[data-name=authpanel]",0);n.authpanel=new ldcover({root:e,baseZ:o.zmgr?"modal":3e3,zmgr:o.zmgr});n.authpanel.on("toggle.on",function(){return setTimeout(function(){return t.get("username").focus()},100)});this._tab="login";this._info="default";this.view=t=new s({root:e,action:{keyup:{input:function(n){var e,t;e=n.node,t=n.evt;if(t.keyCode===13){return i.submit()}}},click:{submit:function(n){var e;e=n.node;return i.submit()},switch:function(n){var e;e=n.node;return i.tab(e.getAttribute("data-name"))}}},init:{submit:function(n){var e;e=n.node;return i.ldld=new ldloader({root:e})}},handler:{submit:function(n){var e;e=n.node;return e.classList.toggle("disabled",!i.ready)},"submit-text":function(n){var e;e=n.node;return e.innerText=u(i._tab==="login"?"Login":"Sign Up")},displayname:function(n){var e;e=n.node;return e.classList.toggle("d-none",i._tab==="login")},info:function(n){var e,t;e=n.node;t=e.getAttribute("data-name")!==i._info;if(e.classList.contains("d-none")||t){return e.classList.toggle("d-none",t)}e.classList.toggle("d-none",true);return setTimeout(function(){return e.classList.toggle("d-none",t)},0)},switch:function(n){var e,t;e=n.node;t=e.getAttribute("data-name");e.classList.toggle("btn-text",i._tab!==t);return e.classList.toggle("btn-primary",i._tab===t)}}});this.form=r=new d({names:function(){return["username","password","displayname"]},afterCheck:function(n,e){if(n.username!==1&&!i.isValid.username(e.username.value)){n.username=2}if(n.password!==1){n.password=!e.password.value?1:!i.isValid.password(e.password.value)?2:0}if(i._tab==="login"){return n.displayname=0}else{return n.displayname=!e.displayname.value?1:!!e.displayname.value?0:2}},root:e});return this.form.on("readystatechange",function(n){i.ready=n;return i.view.render("submit")})})},interface:function(){var t=this;return function(n,e){n==null&&(n=true);e==null&&(e={});if(e.tab){t.mod.tab(e.tab)}if(e.lock){t.mod.ldcv.authpanel.lock()}if(n){return t.mod.ldcv.authpanel.get()}else{return t.mod.auth.fetch().then(function(n){return this.mod.ldcv.authpanel.set(n)})}}},mod:function(n){var e,i,t;e=n.ldview,i=n.ldnotify,t=n.curegex;return{tab:function(n){if(/failed/.exec(this._info)){this._info="default"}this._tab=n;return this.view.render()},isValid:{username:function(n){return t.get("email").exec(n)},password:function(n){return n&&n.length>=8}},info:function(n){this._info=n;return this.view.render("info")},submit:function(){var n,e,t,r=this;if(!this.form.ready()){return}n=this.form.values();e=(t={},t.username=n.username,t.password=n.password,t.displayname=n.displayname,t);return this.ldld.on().then(function(){return debounce(1e3)}).then(function(){var n;n={};return ld$.fetch(r._auth.apiRoot()+""+r._tab,{method:"POST"},{json:e})})["catch"](function(n){if(lderror.id(n)!==1005){return Promise.reject(n)}return ld$.fetch(r._auth.apiRoot()+"reset",{method:"POST"}).then(function(){return r._auth.fetch({renew:true})}).then(function(){return ld$.fetch(r._auth.apiRoot()+""+r._tab,{method:"POST"},{json:e})})}).then(function(){return r._auth.fetch()})["finally"](function(){return r.ldld.off()}).then(function(n){debounce(350,function(){return r.info("default")});r.form.reset();r.ldcv.authpanel.set(n);i.send("success","login successfully");return n})["catch"](function(n){console.log(n);if(lderror.id(n)===1004){return r.info("login-exceeded")}r.info(r._tab+"-failed");r.form.fields.password.value=null;return r.form.check({n:"password",now:true})})}}}};</script></div>
